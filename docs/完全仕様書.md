# æ ªå¼åˆ†æã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨å®Ÿè£…ä»•æ§˜æ›¸

**ğŸ“… æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ25æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Phase 2 å®Ÿè£…ä¸­  
**ãƒ‡ãƒ—ãƒ­ã‚¤URL**: https://j1921604.github.io/stock-analysis/  
**GitHubãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/J1921604/stock-analysis  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**å¯¾è±¡ä¼æ¥­**: æ±äº¬é›»åŠ›ãƒ›ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ï¼ˆ9501ï¼‰ã€ä¸­éƒ¨é›»åŠ›ï¼ˆ9502ï¼‰ã€JERAï¼ˆéä¸Šå ´ï¼‰

---

## ğŸ¯ ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦

ã“ã®ä»•æ§˜æ›¸ã¯ã€**ä»–ã®AIãŒå®Œç’§ã«å†ç¾ã§ãã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã—ãŸå®Œå…¨ãªå®Ÿè£…ä»•æ§˜æ›¸ã§ã™ã€‚
é›»åŠ›æ¥­ç•Œ3ç¤¾ï¼ˆæ±äº¬é›»åŠ›ãƒ»ä¸­éƒ¨é›»åŠ›ãƒ»JERAï¼‰ã«ç‰¹åŒ–ã—ãŸè²¡å‹™ãƒ»æ ªä¾¡åˆ†æã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä»•æ§˜ã‚’ç¶²ç¾…ã—ã¦ã„ã¾ã™ã€‚

### å®Ÿè£…çŠ¶æ³

```mermaid
flowchart TB
  subgraph Implementation["å®Ÿè£…çŠ¶æ³"]
    B1[âœ… Phase 1: åŸºç›¤æ§‹ç¯‰å®Œäº†]
    B2[ğŸ”µ Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè£…ä¸­]
    B3[âšª Phase 3: åˆ†æã‚¨ãƒ³ã‚¸ãƒ³æœªç€æ‰‹]
    B4[âšª Phase 4: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœªç€æ‰‹]
    B5[âšª Phase 5: è‡ªå‹•åŒ–æœªç€æ‰‹]
  end
    
  B1 --> B2
  B2 --> B3
  B3 --> B4
  B4 --> B5
    
  style B1 fill:#fff9c4
  style B2 fill:#f5f5f5
  style B3 fill:#f5f5f5
  style B4 fill:#f5f5f5
  style B5 fill:#f5f5f5
```

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
4. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
5. [ç’°å¢ƒæ§‹ç¯‰æ‰‹é †](#ç’°å¢ƒæ§‹ç¯‰æ‰‹é †)
6. [æ©Ÿèƒ½å®Ÿè£…è©³ç´°](#æ©Ÿèƒ½å®Ÿè£…è©³ç´°)
7. [ãƒ†ã‚¹ãƒˆä»•æ§˜](#ãƒ†ã‚¹ãƒˆä»•æ§˜)
8. [ãƒ‡ãƒ—ãƒ­ã‚¤ä»•æ§˜](#ãƒ‡ãƒ—ãƒ­ã‚¤ä»•æ§˜)
9. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶)
10. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ç›®çš„

é›»åŠ›æ¥­ç•Œ3ç¤¾ï¼ˆæ±äº¬é›»åŠ›ãƒ›ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã€ä¸­éƒ¨é›»åŠ›ã€JERAï¼‰ã«ç‰¹åŒ–ã—ãŸè²¡å‹™ãƒ»æ ªä¾¡è‡ªå‹•åˆ†æã‚·ã‚¹ãƒ†ãƒ ã€‚
GitHubä¸­å¿ƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼é‹ç”¨ã‚³ã‚¹ãƒˆã‚¼ãƒ­ã§ç¶™ç¶šçš„ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒ»åˆ†æã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½

- âœ… **é›»åŠ›3ç¤¾è²¡å‹™ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: æ±äº¬é›»åŠ›ãƒ»ä¸­éƒ¨é›»åŠ›ãƒ»JERAã®è²¡å‹™æŒ‡æ¨™ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–
- âœ… **é›»åŠ›æ¥­ç•Œç‰¹åŒ–æŒ‡æ¨™**: ç‡ƒæ–™è²»èª¿æ•´é¡ã€JERAæœŸãšã‚Œå½±éŸ¿ã€ç™ºé›»æ§‹æˆæ¯”ç‡ç­‰
- âœ… **è‡ªå‹•ãƒ‡ãƒ¼ã‚¿æ›´æ–°**: EDINET API + Yahoo Finance APIã‹ã‚‰æ—¥æ¬¡è‡ªå‹•åé›†
- âœ… **GitHub Pagesé…ä¿¡**: é™çš„ã‚µã‚¤ãƒˆã¨ã—ã¦è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… **ç•°å¸¸æ¤œçŸ¥é€šçŸ¥**: æ ªä¾¡æ€¥å¤‰ãƒ»ROEä½ä¸‹æ™‚ã«GitHub Issueè‡ªå‹•ä½œæˆ

### é–‹ç™ºåŸå‰‡

**å®Œå…¨ä»•æ§˜æ›¸ã®è©³ç´°**: [https://github.com/J1921604/stock-analysis/blob/main/specs/001-stock-analysis-system/spec.md](https://github.com/J1921604/stock-analysis/blob/main/specs/001-stock-analysis-system/spec.md)

**é–‹ç™ºæ†²æ³•**: [https://github.com/J1921604/stock-analysis/blob/main/.specify/memory/constitution.md](https://github.com/J1921604/stock-analysis/blob/main/.specify/memory/constitution.md)

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| **Python** | 3.11+ | ãƒ‡ãƒ¼ã‚¿åé›†ãƒ»åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ |
| **SQLite** | 3.43+ | å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |
| **pandas** | 2.1.4 | ãƒ‡ãƒ¼ã‚¿æ­£è¦åŒ–ãƒ»åˆ†æ |
| **lxml** | 4.9.3 | XBRLè§£æ |
| **yfinance** | 0.2.32 | Yahoo Financeæ ªä¾¡å–å¾— |

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| **sql.js** | 1.8.0 | ãƒ–ãƒ©ã‚¦ã‚¶å†…SQLiteå®Ÿè¡Œ |
| **Chart.js** | 4.4.0 | ã‚°ãƒ©ãƒ•æç”» |
| **Tailwind CSS** | 3.3.0 | ãƒ€ãƒ¼ã‚¯ãƒ»ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯é¢¨UI |

### ã‚¤ãƒ³ãƒ•ãƒ©

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| **GitHub Actions** | æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒãƒƒãƒï¼ˆcron: "0 9 * * *"ï¼‰ |
| **GitHub Pages** | é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° |
| **Git LFS** | SQLiteãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ï¼ˆ100MB+å¯¾å¿œï¼‰ |

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
stock-analysis/
â”œâ”€â”€ .github/workflows/daily-update.yml  # æ—¥æ¬¡è‡ªå‹•æ›´æ–°
â”œâ”€â”€ .specify/memory/constitution.md     # é–‹ç™ºæ†²æ³• v1.0.0
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ db/stock-analysis.db            # SQLiteãƒ¡ã‚¤ãƒ³DB
â”‚   â”œâ”€â”€ raw/xbrl/                       # EDINETç”Ÿãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ analysis/                       # åˆ†æçµæœJSON
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.html                      # ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ styles.css                      # ãƒ€ãƒ¼ã‚¯ãƒ»ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯é¢¨CSS
â”‚   â””â”€â”€ db-loader.js                    # sql.jsãƒ©ãƒƒãƒ‘ãƒ¼
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ fetch_xbrl.py                   # EDINETå–å¾—
â”‚   â”œâ”€â”€ fetch_prices.py                 # æ ªä¾¡å–å¾—
â”‚   â””â”€â”€ analyzers/power_industry.py     # é›»åŠ›æ¥­ç•Œåˆ†æ
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ e2e/test_dashboard.py           # E2Eãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ specs/001-stock-analysis-system/
â”‚   â”œâ”€â”€ spec.md                         # å®Œå…¨ä»•æ§˜ v1.0.0
â”‚   â””â”€â”€ plan.md                         # å®Ÿè£…è¨ˆç”» v1.0.0
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ å®Œå…¨ä»•æ§˜æ›¸.md                   # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â””â”€â”€ DEPLOY_GUIDE.md                 # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ requirements.txt                    # Pythonä¾å­˜é–¢ä¿‚
â”œâ”€â”€ schema.sql                          # DBã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â””â”€â”€ start.ps1                           # ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### ERãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ 

```mermaid
erDiagram
    companies ||--o{ financial_statements : has
    companies ||--o{ stock_prices : has
    companies ||--o{ power_industry_metrics : has
    
    companies {
        text company_id PK
        text name
        text ticker
        integer is_listed
    }
    
    financial_statements {
        integer id PK
        text company_id FK
        text period_end_date
        real revenue
        real operating_income
        real net_income
    }
    
    stock_prices {
        integer id PK
        text company_id FK
        text date
        real close
        integer volume
    }
    
    power_industry_metrics {
        integer id PK
        text company_id FK
        text period_end_date
        real fuel_cost_adjustment
        real jera_period_gap_impact
    }
```

---

## ç’°å¢ƒæ§‹ç¯‰æ‰‹é †

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³

```powershell
git clone https://github.com/J1921604/stock-analysis.git
cd stock-analysis
```

### 2. Pythonä»®æƒ³ç’°å¢ƒä½œæˆ

```powershell
python -m venv venv
.\venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–

```powershell
python scripts/init_db.py
```

### 4. ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•

```powershell
.\start.ps1
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5000 ã«ã‚¢ã‚¯ã‚»ã‚¹

---

## æ©Ÿèƒ½å®Ÿè£…è©³ç´°

### ãƒ‡ãƒ¼ã‚¿åé›†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

#### EDINET XBRLå–å¾—ï¼ˆ`scripts/fetch_xbrl.py`ï¼‰

```python
import requests
import time

EDINET_API_BASE = "https://disclosure2.edinet-fsa.go.jp/api/v2"
COMPANY_CODES = {
    "9501": "E04498",  # æ±äº¬é›»åŠ›
    "9502": "E04506",  # ä¸­éƒ¨é›»åŠ›
}

def fetch_xbrl_list(start_date: str):
    url = f"{EDINET_API_BASE}/documents.json"
    params = {"date": start_date, "type": 2}
    response = requests.get(url, params=params)
    return response.json()

def download_xbrl(doc_id: str, output_dir: str):
    url = f"{EDINET_API_BASE}/documents/{doc_id}"
    response = requests.get(url, params={"type": 1})
    
    output_path = f"{output_dir}/{doc_id}.zip"
    with open(output_path, "wb") as f:
        f.write(response.content)
    
    time.sleep(1)  # ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ
    return output_path
```

#### Yahoo Financeæ ªä¾¡å–å¾—ï¼ˆ`scripts/fetch_prices.py`ï¼‰

```python
import yfinance as yf
import sqlite3

def fetch_stock_prices(ticker: str, start_date: str):
    stock = yf.Ticker(ticker)
    return stock.history(start=start_date)

def save_to_db(ticker: str, df, db_path: str):
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    for date, row in df.iterrows():
        cursor.execute("""
            INSERT OR REPLACE INTO stock_prices
            (company_id, date, open, high, low, close, volume)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, (ticker.replace(".T", ""), date.strftime("%Y-%m-%d"),
              row['Open'], row['High'], row['Low'], row['Close'], int(row['Volume'])))
    
    conn.commit()
    conn.close()
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### index.htmlï¼ˆãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>é›»åŠ›3ç¤¾ è²¡å‹™åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link href="styles.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script type="module" src="db-loader.js"></script>
</head>
<body class="dark-cyberpunk">
    <div class="container">
        <h1 class="neon-green">âš¡ é›»åŠ›æ¥­ç•Œåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <p class="subtitle">æ±äº¬é›»åŠ›ãƒ»ä¸­éƒ¨é›»åŠ›ãƒ»JERA è²¡å‹™æŒ‡æ¨™å¯è¦–åŒ–</p>
        
        <div id="companies" class="company-grid"></div>
    </div>
</body>
</html>
```

#### styles.cssï¼ˆãƒ€ãƒ¼ã‚¯ãƒ»ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯é¢¨ï¼‰

```css
:root {
    --neon-green: #00ff00;
    --neon-magenta: #ff00ff;
    --dark-bg: #0a0a0a;
}

body.dark-cyberpunk {
    background: var(--dark-bg);
    color: var(--neon-green);
    font-family: 'Courier New', monospace;
}

h1.neon-green {
    color: var(--neon-green);
    text-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
}

.glow-button {
    background: var(--neon-green);
    color: var(--dark-bg);
    border: none;
    padding: 1rem 2rem;
    box-shadow: 0 0 15px var(--neon-green);
    transition: all 0.3s;
}

.glow-button:hover {
    box-shadow: 0 0 30px var(--neon-green);
    transform: scale(1.05);
}
```

---

## ãƒ†ã‚¹ãƒˆä»•æ§˜

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```python
import pytest
from scripts.fetch_xbrl import fetch_xbrl_list

def test_fetch_xbrl_list():
    result = fetch_xbrl_list("2025-11-25")
    assert "results" in result
```

### E2Eãƒ†ã‚¹ãƒˆ

```python
from playwright.sync_api import sync_playwright

def test_dashboard_loading():
    with sync_playwright() as p:
        browser = p.chromium.launch()
        page = browser.new_page()
        page.goto("https://j1921604.github.io/stock-analysis/")
        assert page.locator(".company-card").count() == 3
        browser.close()
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ä»•æ§˜

### GitHub Actionsè¨­å®š

```yaml
name: Daily Data Update
on:
  schedule:
    - cron: '0 9 * * *'
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install -r requirements.txt
      - run: python scripts/pipeline.py
      - run: |
          git config user.name "GitHub Actions"
          git add data/db/stock-analysis.db
          git commit -m "chore: Update DB" || echo "No changes"
          git push
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

| é …ç›® | é–¾å€¤ |
|------|------|
| åˆæœŸãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ | < 3ç§’ |
| DBæ¤œç´¢ã‚¯ã‚¨ãƒª | < 500ms |
| ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒãƒƒãƒ | < 30åˆ† |

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q: SQLiteãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„

```powershell
sqlite3 data/db/stock-analysis.db "PRAGMA integrity_check;"
```

### Q: GitHub Actions ã§ API ãƒ¬ãƒ¼ãƒˆåˆ¶é™

```python
import time
from requests.adapters import HTTPAdapter

session = requests.Session()
retry = Retry(total=3, backoff_factor=2)
session.mount('https://', HTTPAdapter(max_retries=retry))
```

---

**å¤‰æ›´å±¥æ­´**:
- 2025-11-25: åˆç‰ˆä½œæˆï¼ˆv1.0.0ï¼‰- é›»åŠ›3ç¤¾ç‰¹åŒ–ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦æ§‹ç¯‰
