
# AI株式分析システム 仕様書（完全再現用）

---

# 1. システム概要

AI を活用し、日本の上場企業のデータ（株価・XBRL・決算情報 等）を自動収集・蓄積・解析し、複数の投資指標に基づくランキング・個別銘柄分析・マーケット天井検出などの可視化ページを自動生成する完全自動化システムである。

特徴:
- データ解析ロジックの 95%以上を AI が生成
- インフラは **S3 + GitHub Actions + GitHub Pages** のみ
- データベースは **SQLite 1ファイル** に全集約
- バッチ処理は **GitHub Actions の cron** のみ
- 解析ページは **static HTML (1ファイルSPA)** でブラウザ内で完結
- 通知は **GitHub Issue自動作成** を利用

---

# 2. 全体アーキテクチャ

```
+-------------------------------+
| GitHub Actions (Daily Cron)   |
|  - XBRL/株価 取得             |
|  - パース・正規化             |
|  - SQLite 更新                 |
|  - 生データ S3 sync            |
|  - 解析 & シグナル検出        |
|  - 通知(issue生成)            |
+-------------------------------+
                 |
                 v
+-------------------------------+
| AWS S3                        |
|  - 生データ (XBRL, 株価 etc)  |
|  - SQLite 最新版              |
|  - SQLite.gz                  |
+-------------------------------+
                 |
                 v
+-------------------------------+
| GitHub Pages                  |
|  - HTML/JS/CSS (1ファイル)    |
|  - SQLite をpresigned URLで取得|
|  - ブラウザ内で解析           |
+-------------------------------+
```

---

# 3. 主要コンポーネント

## 3.1 データ収集コンポーネント
### 3.1.1 取得対象データ
- 株価データ（各種API または JPX / 適宜ソース）
- XBRL（EDINET、取得制限: 過去10年）
- 決算情報マーカー

### 3.1.2 GitHub Actions による日次バッチ
```
on:
  schedule:
    - cron: "0 9 * * *"  # JST 18:00
  workflow_dispatch:
```

### 3.1.3 日次処理内容
1. 最新の SQLite を S3 から取得
2. 当日更新分の **株価 + XBRL** をダウンロード（DoS避け: 1秒1ファイル）
3. パース → 正規化 → SQLiteへ追記
4. 生データを `aws s3 sync` で永続保存
5. SQLite最新版を S3 に上書き保存（バージョニングON）
6. 解析ロジックを実行し、シグナル検出
7. 新規銘柄があれば GitHub Issue を作成
8. Summary UIにSQLiteの presigned URL と解析リンクを書き出し

---

## 3.2 データ保管コンポーネント
### 3.2.1 S3 保管構造
- `/raw/xbrl/YYYY/*.xbrl`：生データ（年単位で tar.gz 圧縮し Glacier Deep Archive）
- `/raw/price/*.csv`：株価
- `/db/latest.sqlite`：最新DB
- `/db/latest.sqlite.gz`：軽量ダウンロード版

### 3.2.2 ポリシー
- XBRLはEDINET制限のため **必ず永続保存**
- SQLiteは **バージョン管理有効**
- 全てフルマネージド（サーバ常駐なし）

---

# 4. 解析ロジック / 機能一覧

## 4.1 ネットネットバリュー株ランキング
### 4.1.1 指標定義
- 即時現金化可能資産 − 総負債
- 上記を時価総額で割った独自PBR
- 1を割ると割安
- ユーザーパラメータ:
  - 「即時現金化可能」に含める科目の選択
  - 各資産の割引率

### 4.1.2 提供ページ
- ランキング一覧ページ
- 過去PBR推移チャート軽量描画（lightweight-charts）

---

## 4.2 オニール成長株ランキング
### 4.2.1 指標
- EPS成長率
- リラティブストレングス（株価推移指標）

### 4.2.2 詳細ページ
- 決算発表マーカー可視化
- シグナル区間を背景色で表示
- 1ファイルSPAで完結（HTMLのみ）

---

## 4.3 マーケット天井検出
### 4.3.1 ロジック
- 「オニールの成長株発掘法」の「分配日」カウント方式
- シグナル日をマーカー表示
- 注意期間を背景色表示

### 4.3.2 補足
- パラメータ最適化は **ベイズ最適化試行 → 失敗**

---

# 5. 解析ページ（GitHub Pages）

## 5.1 特徴
- Gemini canvas モードで生成
- HTML 1ファイル（ビルドなし）
- 内部に JS/CSS 完全埋め込み
- sqlite-wasm を使用し **ブラウザ内で SQLite クエリ**
- チャートは lightweight-charts（高速）
- 初回アクセス時に SQLite をブラウザで自動ダウンロード
- ローカルのSQLiteを手動指定可能（開発便利）
- presigned URL は GitHub Actions が毎日更新

---

# 6. 通知（GitHub Issue）

## 6.1 なぜ issue 通知か
- メール送信サービスの設定が面倒
- Gmail API の認証も不要にしたい

## 6.2 通知の仕組み
- 新規銘柄検出 → GitHub Actions が issue 作成
- Issue 作成通知メールが飛ぶ
- ユーザーは Issue を見て判断し、不要なら close
- ログ代わりにもなる

---

# 7. 開発・運用ポリシー

## 7.1 自動化重視
- 人手が介入する操作をゼロへ
- 株売買だけは手動判断

## 7.2 メンテコスト最小化
- 24時間稼働サーバーを持たない
- フルマネージド（S3 + GitHub）へ集約
- 利用サービス数削減 → 障害要因削減

## 7.3 個人開発の思想
- 「放置しても壊れない」堅牢さ優先
- データ解析の UI も 1ファイル完結

---

# 8. 製作者コメント / 補足
- システム構築は 3ヶ月（休日・仕事後のみ）
- AI コーディングは約95%
- アイデア → 実装 のコストを劇的に削減
- ただし “効率が高いアーキテクチャ設計” は依然として人間が必要
- 運用成績は日経平均に負けている（オチ）

---

# 付録（今後追加予定）
- XBRL パース仕様
- SQLite スキーマ詳細
- 解析アルゴリズムの数式化
- GitHub Actions の完全YAML
- HTML/JS（1ファイルSPA）完全コード
- API ソース一覧

---

必要であれば、この仕様書をさらに細分化（/docs/配下の複数Markdownに分割）した形式や、Spec Kit 用テンプレートへの変換も続けて実施できます。

