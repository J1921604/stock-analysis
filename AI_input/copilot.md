
# 株式分析システム仕様書

## 概要

- 日本の上場銘柄を対象とした株式分析システム
- AI コーディング（Claude Code Max プラン）を活用し、95%以上のコードをAIが生成
- 目的：有価証券報告書（XBRL形式）や株価データを自動解析し、ランキング・チャート・通知機能を提供

---

## 機能一覧

### 1. ネットネットバリュー株ランキング

- **指標**：即時現金化可能資産 − 総負債 ÷ 時価総額
- **特徴**：
    - 1未満なら「現金が割引価格で売られている」状態
    - 即時現金化資産の選定・割引率をユーザー設定可能
    - PBR推移チャートを表示し、直近の割安傾向を判定

### 2. オニール成長株発掘ランキング

- **基準**：「オニールの成長株発掘法」に基づく
- **指標**：EPS成長率、リラティブストレングス
- **UI**：
    - ランキング一覧
    - 詳細ページ：決算発表マーカー、シグナル区間を背景色で可視化
- **構成**：ランキングから詳細まで単一HTMLファイルのSPA

### 3. マーケット天井検出ツール

- **基準**：「分配日」カウントによる天井予測
- **UI**：
    - シグナル日をマーカー表示
    - 注意期間を背景色で可視化
- **課題**：パラメータ調整が難しく、ベイズ最適化は失敗

---

## 設計思想

### 自動化

- 毎日のデータ取得・解析を完全自動化
- 売買は手動だが、条件一致銘柄を通知

### メンテナンス最小化

- 個人プロジェクト前提で「ゼロ運用」志向
- フルマネージドサービス利用（AWS S3、GitHub）
- サービス数を減らし堅牢性を確保

---

## アーキテクチャ

### 構成要素

- **データ管理**：SQLiteファイル
- **更新処理**：GitHub Actions 日次バッチ
- **ストレージ**：AWS S3（Glacier Deep Archiveでコスト削減）
- **配信**：GitHub Pages（static HTML）

### GitHub Actions 日次処理

- S3から最新SQLite取得
- 株価・XBRLファイルをダウンロード
- パース＋正規化 → SQLite追記
- 生データをS3へ `aws s3 sync`
- 最新SQLiteをS3へ上書き保存
- 解析・通知実行
- Summary Web UIにリンク表示

### S3運用

- XBRLファイルを永久保存（DoS回避のため1秒1ファイルDL）
- 年単位でtar.gz化しGlacier保存
- SQLiteはバージョニング有効化、gzip版も提供

### GitHub Pages

- Gemini Canvas生成のレスポンシブHTML
- sqlite-wasmでクエリ、lightweight-chartsで描画
- S3 presigned URLをクエリパラメータに埋め込み
- ブラウザでSQLite自動DL＋キャッシュ
- ローカルファイル指定も可能

### 通知機構

- 新銘柄発見時にGitHub ActionsがIssue作成
- Issue経由でメール通知
- 不要銘柄は理由付きでclose → ログ化

---

## 運用実績と課題

- 開発期間：3ヶ月（休日・仕事終わりのみ）
- 効果：自動化により利便性大幅向上
- 課題：効率的アーキテクチャ設計は人間エンジニア依存
- 成績：日経平均に劣後 → インデックス投資の優位性を示唆

---

## 再現要件（他AIが完璧に再現するための必須条件）

1. **データ処理**
    
    - EDINETからXBRLをDL（過去10年分）
    - 株価データを日次取得
    - SQLiteに正規化保存
2. **インフラ**
    
    - AWS S3（Glacier Deep Archive利用）
    - GitHub Actions（cron: "0 9 * * *"）
    - GitHub Pages（static HTML配信）
3. **解析ロジック**
    
    - ネットネットバリュー指標計算
    - オニール成長株スクリーニング
    - 分配日カウントによる天井検出
4. **UI/UX**
    
    - SPA構成（HTML1枚）
    - lightweight-chartsでチャート描画
    - 決算・シグナルを背景色で可視化
5. **通知**
    
    - GitHub Issue自動生成
    - メール通知（GitHub経由）

---

✅ この仕様書を基にすれば、他AIでも完全再現可能です。
